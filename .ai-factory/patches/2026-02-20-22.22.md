# Add prompt preview and lesson mode (UKR -> EN)

**Date:** 2026-02-20 22:22
**Files:** public/index.php, src/Controllers/ApiController.php, src/Services/OpenAIService.php, src/Controllers/WebController.php, public/assets/app.js, public/assets/styles.css
**Severity:** medium

## Problem

User could not see the exact generated system prompt after selecting mode/topic/grammar, making it hard to reuse the prompt in ChatGPT. Also the app lacked a dedicated lesson flow for Ukrainian-to-English translation drills.

## Root Cause

Prompt construction was embedded only inside `tutorReply()` and not exposed through any API/UI. The UI supported only one conversation flow and had no mode switch.

## Solution

- Extracted reusable prompt builder in `OpenAIService::buildTutorSystemPrompt(...)`.
- Added `GET /api/prompt-preview` endpoint to return the exact system prompt.
- Added UI block with read-only prompt textarea and `Copy Prompt` button.
- Added `Mode` selector with `conversation` and `lesson`.
- Wired `mode` through session/chat payloads and prompt-preview query.
- Implemented lesson instructions in the system prompt for UKR -> EN drill workflow.

## Prevention

- Keep prompt generation centralized in one method shared by runtime and preview.
- For every new assistant mode, expose mode in both API contract and UI controls.
- Add integration test for `/api/prompt-preview` and a frontend test for copy behavior.

## Tags

`#prompt` `#lesson-mode` `#frontend` `#api` `#openai`
